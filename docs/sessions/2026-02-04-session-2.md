# Session 2 – 2026-02-04

## Project state at start of session

- Next.js 15 scaffold fully created: 13 route pages across `(app)/` and `(auth)/` groups, 8 shadcn/ui components, Tailwind v4, Zustand, TanStack Query — all installed and compiled.
- `/docs` populated with 7 files: PRD (overview + complete), database schema (35+ tables), design system, UX/UI guidelines, locked decisions, discovery doc.
- Git: local repo on `master`, 2 commits, no remote.
- Supabase: client packages installed (`@supabase/supabase-js`, `@supabase/ssr`), `.env.local.example` present, but no `.env.local` with real keys.
- GitHub: repo not yet created.

## What we did today

1. **Audited full project state** — read all `/docs` files, verified scaffold structure, confirmed what was and wasn't done in session 1.
2. **Created `CLAUDE.md`** — project guide covering role/facts, must-follow rules (including mandatory session logging), tech stack, folder structure, Supabase/Gemini patterns, and workflow/safety conventions. Committed to `main`.
3. **Connected Supabase** — created `.env.local` with real project URL + anon key + service-role key. Verified connection (REST endpoint returned 200 with schema). File is gitignored.
4. **Connected GitHub** — created repo `salikkhann/dowos`, renamed local branch `master` → `main`, added remote origin, pushed all 3 commits. `main` now tracks `origin/main`.
5. **Created session doc, roadmap, and todo** — `docs/sessions/2026-02-04-session-2.md`, `docs/roadmap-day-by-day.md`, `docs/todo-current.md`. All committed and pushed.
6. **Expanded roadmap with architecture decision sprint** — Phase 1 now includes 6 dedicated decision days (Days 3–8): RAG architecture, Maps platform (Google Maps vs OSM), Voice/STT, AI routing & fallback, Mobile delivery (Capacitor vs PWA), Viva Bot orchestration (LangGraph vs state machine). Each outputs a doc to `docs/decisions/`. Day 9 is sign-off + update to `FINAL_LOCKED_DECISIONS.md`.
7. **Added admin dashboard + content upload tooling** to Phase 2 roadmap — `/admin/` route group (service-role gated), MCQ/Viva/textbook upload pages, upload validation, status indicators. Created `docs/decisions/` folder with `.gitkeep`.
8. **Reviewed all skills** relevant to the project (`claude-code-guide`, `ai-engineer`, `nextjs-app-router-patterns`, `context-manager`, `cost-optimization`, `nextjs-supabase-auth`, `context-compression`, `strategic-compact`). Produced IDE + model recommendation.
9. **Fixed Supabase MCP config** — `.claude/settings.json` had `${...}` variable syntax in the URL and Bearer token. JSON does not interpolate — replaced with literal strings. MCP should now connect.
10. **Updated CLAUDE.md** with three token-efficiency rules (never bulk-read schema doc, compact at task boundaries, Sonnet by default / Opus only for decision days) and a new "Skills & Tooling" section (skills path, 9-skill reference table, MCP usage note).

## Decisions made

- Branch `master` renamed to `main` to match configured PR target.
- CLAUDE.md rule #11 / Workflow #8: session doc updates are mandatory at end of every session.
- **IDE:** Claude Code (CLI) as primary build tool. Cursor / VS Code as secondary for reading and navigation only.
- **Model routing:** Sonnet for all day-to-day coding. Opus reserved for the 6 architecture decision days (Days 3–8) only.
- **Token discipline:** Never read `docs/02_DATABASE_SCHEMA.md` in full — use Supabase MCP for live schema queries. Manual `/compact` at task boundaries, not mid-task.
- **Architecture decisions deferred, not guessed:** Maps (Google Maps vs OSM), Voice/STT, AI fallback routing, Mobile delivery, Viva Bot orchestration, and RAG design all get a dedicated evaluation day with a written decision doc before any code is written against them.
- **Admin tooling ships in Phase 2** (before AI features in Phase 3) so content team (Azfar) can seed MCQs, Viva sheets, and textbooks before students need them.

## Commits this session

| Hash | Message |
|---|---|
| `b9a52b1` | docs: add CLAUDE.md project guide |
| `8403c88` | docs: add roadmap, session log, and current todo |
| `48919e3` | chore: fix Supabase MCP config, add token-efficiency rules and skills map |

## Next immediate steps

1. Create `src/lib/supabase.ts` — wire up `createBrowserClient` / `createServerClient` using env vars.
2. Create the first Supabase migration: `users` + `user_preferences` tables (the auth-gate tables everything else depends on).
3. Build the Auth flow: signup (email → OTP → profile → ID photo upload) + login + middleware route guard.
4. Stand up the dashboard shell with bottom-nav (mobile) / sidebar (desktop).
5. Days 3–8: run the architecture decision sprint (see `docs/roadmap-day-by-day.md` Phase 1).
