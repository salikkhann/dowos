# Session 3 – 2026-02-05

## Project state at start of session

- `main` at `620a7e2` — auth + onboarding merged, Day 3 RAG initial version committed (with spaced-rep, adaptive difficulty, PDF past-paper extraction still in docs).
- Three edits to `rag-architecture.md` (§4.2 chunking, §6 ingestion, §7 query flow) had been applied but NOT committed — carried over as uncommitted working-tree changes from the previous context.
- `model-selection.md` at its initial committed state — needed corresponding cuts.
- Days 4–9 decision docs not yet started.

## What we did today

### Day 3 finalisation (continued from session 2)

1. **Applied remaining rag-architecture.md edits** after the three that were already done in the previous context:
   - §1 locked table: updated Knowledge corpus (CSV/JSON not PDFs), High-yield layer (no extraction step), Tutor modes (Quick / Tutor / Socratic), Pro personalisation (removed spaced-rep + adaptive difficulty).
   - §2 open questions: item 9 rewritten to reflect current Pro feature set.
   - §4 diagram: replaced the Complexity Router box with a Mode Toggle box (Quick → Flash, Tutor → Flash, Socratic → R1 Pro-gated). Added complexity-bump as a secondary safety net under Quick/Tutor only. Updated `google_search` note to "Quick / Tutor only — not Socratic". Updated persona line to "Quick / Tutor / Socratic tone".
   - §5 tables: `chat_sessions.mode` enum updated to `quick | tutor | socratic`; `past_paper_questions` description updated to "imported from CSV / JSON".
   - §8 intro: rewritten to lead with Socratic as headline Pro experience.
   - §8.1 feature map: removed P1 (spaced-rep) and P2 (adaptive difficulty). Renumbered: P1 = weekly study plan, P2 = exam-readiness score, P3 = Socratic deep-dive, P4 = progress narrative. Updated P1 description (no "spaced-rep due" balancing). Updated P2 description (no spaced-rep completion in formula).
   - §8.2 exam-readiness formula: removed the `0.20 × spaced_rep_completion_rate` term. Redistributed weight: MCQ 0.35 → 0.40, Viva 0.25 → 0.30, High-yield coverage 0.15 → 0.20, Attendance 0.05 → 0.10. Sum = 1.00 ✓.
   - §8.3: deleted the entire SM-2 lite spaced-repetition interval logic section. Old §8.4 (free/Pro table) became §8.3; old §8.5 (cost table) became §8.4.
   - §8.3 (was §8.4) free/Pro table: removed spaced-rep and adaptive-difficulty rows. Added Quick / Tutor / Socratic mode rows with correct gating.
   - §8.4 (was §8.5) cost table: removed P2 adaptive-difficulty row. Removed "P1 + P4 (pure SQL)" line. Added P2 exam-readiness (pure SQL, $0.000). Recalculated total: $0.019/day ≈ $0.57/month. Updated PKR cost estimate.
   - §9 Phase 3 Day 19: past-paper pipeline → CSV/JSON validate + embed + insert (no PDF extraction).
   - §9 Phase 3 Day 21: complexity router → mode toggle route (read persisted mode → optional bump → context assembly → stream).
   - §9 Phase 3 Day 22: Chat vs Tutor toggle → Quick / Tutor / Socratic toggle with Pro paywall CTA.
   - §9 Phase 4: removed Day 26 (spaced-rep engine) and Day 27 (adaptive difficulty). Collapsed freed days: Day 26 = exam-readiness + study plan, Day 27 = Socratic + progress narrative, Day 28 = Pro paywall smoke test. Old Day 28 and 29 merged; old Day 30 became Day 28.
   - §10 sources: removed SM-2 Wikipedia link; replaced adaptive-difficulty Khan Academy link with Socratic-method Khan Academy link.

2. **Applied corresponding model-selection.md edits:**
   - §3.3 call map: removed "Past-paper Q extraction (ingestion)" row (no extraction step). Removed "Adaptive difficulty classifier (P2)" row. Renumbered remaining Pro features as P1, P3, P4.
   - §4.2 signal taxonomy: removed "Spaced-rep overdue (Pro)" and "Adaptive difficulty level (Pro)" rows.
   - §4.3 DDL comment: removed `'spaced_rep'` and `'difficulty_level'` from `signal_type` enum comment.

3. **Committed + pushed** both docs as `9d4829c`.
4. **Updated `docs/todo-current.md`** Day 3 line with companion deliverable note.
5. **Created this session doc.**

### Auto mode added (same session, after initial cuts)

6. **Re-added complexity router as Auto mode (the default).** User confirmed the complexity router must stay — it becomes the engine behind a new **Auto** mode. Auto is the default; student can override to Quick / Tutor / Socratic. Updated both docs:
   - rag-architecture: §1 locked table, §4 top-level diagram (three-column routing: Auto → full router, Quick/Tutor → Flash + bump, Socratic → R1), §4.5 mode tones (Auto / Quick / Tutor / Socratic each defined), §5 `chat_sessions.mode` enum (`auto | quick | tutor | socratic`), §7 query-flow diagram, §8.3 free/Pro table (Auto row added), §9 Day 21+22 build items, google_search scoped to Auto / Quick / Tutor.
   - model-selection: §3.2 annotated that Auto drives the full complexity router; §3.3 call map split into Auto SIMPLE / Auto COMPLEX / Quick+Tutor / Socratic rows.
7. **Committed + pushed** as `96c67f7`.

## Decisions made

- **Auto mode is the default.** It runs the full Flash-Lite complexity router on every query: SIMPLE → Flash + grounding, COMPLEX → R1. This is the "smart" default — the system decides which model fits the question.
- **Quick and Tutor bypass the full router.** They go straight to Flash. A lightweight bump safety net can still swap one reply to R1 if genuinely hard, but the student's explicit mode choice is respected.
- **Socratic always uses R1, no router involved.** Pro-only. Guiding questions only — never gives the answer directly.
- **Spaced repetition and adaptive difficulty are cut from the AI tutor scope.** Flashcards deferred to Phase 2. Adaptive difficulty unnecessary with mode toggle.
- **Past-paper ingestion is CSV/JSON only.** No PDF extraction.
- **Exam-readiness formula rebalanced** without spaced-rep: MCQ 40 %, Viva 30 %, High-yield coverage 20 %, Attendance 10 %.

## Commits this session

| Hash | Message |
|---|---|
| `9d4829c` | docs: apply tutor-mode toggle cuts to RAG + model-selection docs |
| `12a110d` | docs: add session 3 log, update todo with Day 3 finalisation |
| `96c67f7` | docs: add Auto mode (default) backed by the full complexity router |

## Next immediate steps

1. **Day 4 – Maps platform:** Compare Google Maps JS SDK vs OSM / OpenLayers. Write `docs/decisions/maps-platform.md`.
2. **Days 5–8** — Voice/STT, AI routing benchmark, Mobile delivery, Viva orchestration decision docs.
3. **Day 9 – Sign-off:** Review all 6 decision docs, update `docs/FINAL_LOCKED_DECISIONS.md`.
