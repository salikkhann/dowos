# Session 3 – 2026-02-05

## Project state at start of session

- `main` at `620a7e2` — auth + onboarding merged, Day 3 RAG initial version committed (with spaced-rep, adaptive difficulty, PDF past-paper extraction still in docs).
- Three edits to `rag-architecture.md` (§4.2 chunking, §6 ingestion, §7 query flow) had been applied but NOT committed — carried over as uncommitted working-tree changes from the previous context.
- `model-selection.md` at its initial committed state — needed corresponding cuts.
- Days 4–9 decision docs not yet started.

## What we did today

### Day 3 finalisation (continued from session 2)

1. **Applied remaining rag-architecture.md edits** after the three that were already done in the previous context:
   - §1 locked table: updated Knowledge corpus (CSV/JSON not PDFs), High-yield layer (no extraction step), Tutor modes (Quick / Tutor / Socratic), Pro personalisation (removed spaced-rep + adaptive difficulty).
   - §2 open questions: item 9 rewritten to reflect current Pro feature set.
   - §4 diagram: replaced the Complexity Router box with a Mode Toggle box (Quick → Flash, Tutor → Flash, Socratic → R1 Pro-gated). Added complexity-bump as a secondary safety net under Quick/Tutor only. Updated `google_search` note to "Quick / Tutor only — not Socratic". Updated persona line to "Quick / Tutor / Socratic tone".
   - §5 tables: `chat_sessions.mode` enum updated to `quick | tutor | socratic`; `past_paper_questions` description updated to "imported from CSV / JSON".
   - §8 intro: rewritten to lead with Socratic as headline Pro experience.
   - §8.1 feature map: removed P1 (spaced-rep) and P2 (adaptive difficulty). Renumbered: P1 = weekly study plan, P2 = exam-readiness score, P3 = Socratic deep-dive, P4 = progress narrative. Updated P1 description (no "spaced-rep due" balancing). Updated P2 description (no spaced-rep completion in formula).
   - §8.2 exam-readiness formula: removed the `0.20 × spaced_rep_completion_rate` term. Redistributed weight: MCQ 0.35 → 0.40, Viva 0.25 → 0.30, High-yield coverage 0.15 → 0.20, Attendance 0.05 → 0.10. Sum = 1.00 ✓.
   - §8.3: deleted the entire SM-2 lite spaced-repetition interval logic section. Old §8.4 (free/Pro table) became §8.3; old §8.5 (cost table) became §8.4.
   - §8.3 (was §8.4) free/Pro table: removed spaced-rep and adaptive-difficulty rows. Added Quick / Tutor / Socratic mode rows with correct gating.
   - §8.4 (was §8.5) cost table: removed P2 adaptive-difficulty row. Removed "P1 + P4 (pure SQL)" line. Added P2 exam-readiness (pure SQL, $0.000). Recalculated total: $0.019/day ≈ $0.57/month. Updated PKR cost estimate.
   - §9 Phase 3 Day 19: past-paper pipeline → CSV/JSON validate + embed + insert (no PDF extraction).
   - §9 Phase 3 Day 21: complexity router → mode toggle route (read persisted mode → optional bump → context assembly → stream).
   - §9 Phase 3 Day 22: Chat vs Tutor toggle → Quick / Tutor / Socratic toggle with Pro paywall CTA.
   - §9 Phase 4: removed Day 26 (spaced-rep engine) and Day 27 (adaptive difficulty). Collapsed freed days: Day 26 = exam-readiness + study plan, Day 27 = Socratic + progress narrative, Day 28 = Pro paywall smoke test. Old Day 28 and 29 merged; old Day 30 became Day 28.
   - §10 sources: removed SM-2 Wikipedia link; replaced adaptive-difficulty Khan Academy link with Socratic-method Khan Academy link.

2. **Applied corresponding model-selection.md edits:**
   - §3.3 call map: removed "Past-paper Q extraction (ingestion)" row (no extraction step). Removed "Adaptive difficulty classifier (P2)" row. Renumbered remaining Pro features as P1, P3, P4.
   - §4.2 signal taxonomy: removed "Spaced-rep overdue (Pro)" and "Adaptive difficulty level (Pro)" rows.
   - §4.3 DDL comment: removed `'spaced_rep'` and `'difficulty_level'` from `signal_type` enum comment.

3. **Committed + pushed** both docs as `9d4829c`.
4. **Updated `docs/todo-current.md`** Day 3 line with companion deliverable note.
5. **Created this session doc.**

## Decisions made

- **Tutor modes are the primary UX switch, not the complexity router.** The student explicitly picks Quick (fast direct answers), Tutor (step-by-step teaching), or Socratic (guiding questions, Pro-only). The old complexity router is demoted to a lightweight "bump" safety net that can swap one reply to R1 if a genuinely hard question lands in Quick/Tutor mode — it never overrides the student's choice.
- **Spaced repetition and adaptive difficulty are cut from the AI tutor scope.** Flashcards (which are the natural UX for spaced-rep) are a separate Phase 2 feature. Adaptive difficulty is unnecessary when the student can self-select difficulty via mode toggle.
- **Past-paper ingestion is CSV/JSON only.** AMBOSS/UWorld-style structured exports. No PDF extraction — removes a failure-prone step, eliminates Flash-Lite extraction calls from the ingestion path, and cuts latency + cost.
- **Exam-readiness formula rebalanced** without spaced-rep: MCQ 40 %, Viva 30 %, High-yield coverage 20 %, Attendance 10 %.

## Commits this session

| Hash | Message |
|---|---|
| `9d4829c` | docs: apply tutor-mode toggle cuts to RAG + model-selection docs |

## Next immediate steps

1. **Day 4 – Maps platform:** Compare Google Maps JS SDK vs OSM / OpenLayers. Write `docs/decisions/maps-platform.md`.
2. **Days 5–8** — Voice/STT, AI routing benchmark, Mobile delivery, Viva orchestration decision docs.
3. **Day 9 – Sign-off:** Review all 6 decision docs, update `docs/FINAL_LOCKED_DECISIONS.md`.
